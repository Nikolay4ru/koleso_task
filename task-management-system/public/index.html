<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <title>Enterprise Messenger</title>
    
    <!-- CSS FILES -->
    
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/design-fixes.css">
    <link rel="stylesheet" href="/css/mobile-navigation.css">
     <link rel="stylesheet" href="/css/mobile-universal.css">
    <link rel="stylesheet" href="/css/mobile-gamified-complete.css">
    
    
    <!-- FONTS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
    <!-- Login Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container" id="authContainer">
            <div class="auth-card">
                <div class="auth-header">
                    <div class="logo">
                        <span class="material-icons">video_call</span>
                    </div>
                    <h1>Enterprise Messenger</h1>
                    <p>–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</p>
                </div>

                <div id="loginForm" class="auth-form">
                    <div class="input-group">
                        <label for="loginUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="loginUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" autocomplete="username">
                    </div>
                    <div class="input-group">
                        <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="current-password">
                    </div>
                    <button id="loginBtn" class="btn-primary">–í–æ–π—Ç–∏</button>
                    <p class="auth-switch">
                        –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="showRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                    </p>
                </div>

                <div id="registerForm" class="auth-form" style="display: none;">
                    <div class="input-group">
                        <label for="registerName">–ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                        <input type="text" id="registerName" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
                    </div>
                    <div class="input-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" placeholder="ivan@company.com">
                    </div>
                    <div class="input-group">
                        <label for="registerUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="registerUsername" placeholder="ivan.ivanov">
                    </div>
                    <div class="input-group">
                        <label for="registerPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="registerPassword" placeholder="–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤">
                    </div>
                    <button id="registerBtn" class="btn-primary">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                    <p class="auth-switch">
                        –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="showLogin">–í–æ–π—Ç–∏</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-toggle-btn" id="sidebarToggleBtn" title="–°–≤–µ—Ä–Ω—É—Ç—å –ø–∞–Ω–µ–ª—å">
                <span class="material-icons">chevron_left</span>
            </button>
            
            <div class="sidebar-header">
                <div class="user-profile" id="openProfileBtn" style="cursor: pointer;" data-tooltip="–ü—Ä–æ—Ñ–∏–ª—å">
                    <div class="user-avatar" id="currentUserAvatar">
                        <span class="material-icons">person</span>
                    </div>
                    <div class="user-info">
                        <h3 id="currentUserName">User</h3>
                        <span class="user-status online">–í —Å–µ—Ç–∏</span>
                    </div>
                </div>
                <button class="icon-btn" id="newChatBtn" title="–ù–æ–≤—ã–π —á–∞—Ç" data-tooltip="–ù–æ–≤—ã–π —á–∞—Ç">
                    <span class="material-icons">add_comment</span>
                </button>
            </div>

            <div class="sidebar-tabs">
                <button class="tab-btn active" data-tab="chats" data-tooltip="–ß–∞—Ç—ã">
                    <span class="material-icons">chat</span>
                    <span>–ß–∞—Ç—ã</span>
                </button>
                <button class="tab-btn" data-tab="tasks" data-tooltip="–ó–∞–¥–∞—á–∏">
                    <span class="material-icons">task_alt</span>
                    <span>–ó–∞–¥–∞—á–∏</span>
                </button>
                <button class="tab-btn" data-tab="contacts" data-tooltip="–ö–æ–Ω—Ç–∞–∫—Ç—ã">
                    <span class="material-icons">contacts</span>
                    <span>–ö–æ–Ω—Ç–∞–∫—Ç—ã</span>
                </button>
                <!-- Admin tab - visible only for admins -->
                <button class="tab-btn" data-tab="admin" id="adminTab" style="display: none;" data-tooltip="–ê–¥–º–∏–Ω">
                    <span class="material-icons">admin_panel_settings</span>
                    <span>–ê–¥–º–∏–Ω</span>
                </button>
            </div>

            <div class="sidebar-search">
                <span class="material-icons">search</span>
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤ –∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤...">
            </div>

            <div class="sidebar-content">
                <div id="chatsTab" class="tab-content active">
                    <div id="chatsList" class="chats-list"></div>
                </div>
                
                <div id="contactsTab" class="tab-content">
                    <div id="contactsList" class="contacts-list"></div>
                </div>
                
                <div id="tasksTab" class="tab-content">
                    <div class="tasks-view-header">
                        <div class="view-toggle">
                            <button class="view-toggle-btn active" data-view="board">
                                <span class="material-icons">view_kanban</span>
                                <span>–î–æ—Å–∫–∞</span>
                            </button>
                            <button class="view-toggle-btn" data-view="list">
                                <span class="material-icons">view_list</span>
                                <span>–°–ø–∏—Å–æ–∫</span>
                            </button>
                        </div>
                        <button class="icon-btn" id="createTaskBtnSidebar" data-tooltip="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞">
                            <span class="material-icons">add</span>
                        </button>
                    </div>
                    
                    <div class="tasks-filters-bar">
                        <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                        <button class="filter-btn" data-filter="my">–ú–æ–∏</button>
                        <button class="filter-btn" data-filter="created">–°–æ–∑–¥–∞–Ω–Ω—ã–µ</button>
                        <button class="filter-btn" data-filter="watching">–ù–∞–±–ª—é–¥–∞—é</button>
                    </div>
                    
                    <div id="tasksViewContainer"></div>
                </div>
            </div>
        </aside>

        <!-- Chat Area -->
        <div id="chatArea" class="chat-area">
            <div id="welcomeScreen" class="welcome-screen">
                <div class="welcome-content">
                    <span class="material-icons">forum</span>
                    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Enterprise Messenger</h2>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—â–µ–Ω–∏—è</p>
                    <button class="btn-primary" id="welcomeNewChat">
                        <span class="material-icons">add</span>
                        –ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
                    </button>
                </div>
            </div>

            <div id="chatContainer" class="chat-container" style="display: none;">
                <!-- Chat Header -->
                <div class="chat-header" id="chatHeader">
                    <!-- –ù–û–í–û–ï: –ú–æ–±–∏–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" -->
                    <button class="mobile-back-btn" onclick="mobileNavigation && mobileNavigation.goBack()">
                        <span class="material-icons">arrow_back</span>
                    </button>
                    
                    <!-- –û–ë–ù–û–í–õ–ï–ù–û: –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è Chat Info -->
                    <div class="chat-info" id="chatHeaderInfo" style="cursor: pointer;">
                        <div class="chat-avatar" id="chatAvatarHeader">
                            <span class="material-icons">person</span>
                        </div>
                        <div>
                            <h3 id="chatName">Chat Name</h3>
                            <p id="chatStatus" class="chat-status">–í —Å–µ—Ç–∏</p>
                        </div>
                    </div>
                    
                    <div class="chat-actions">
                        <button class="icon-btn" id="audioCallBtn" title="–ê—É–¥–∏–æ –∑–≤–æ–Ω–æ–∫">
                            <span class="material-icons">call</span>
                        </button>
                        <button class="icon-btn" id="videoCallBtn" title="–í–∏–¥–µ–æ –∑–≤–æ–Ω–æ–∫">
                            <span class="material-icons">videocam</span>
                        </button>
                        <!-- –ù–û–í–û–ï: –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è Chat Info Panel -->
                        <button class="icon-btn chat-info-toggle" id="chatInfoBtn" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ">
                            <span class="material-icons">info</span>
                        </button>
                    </div>
                </div>

                <!-- Messages Area -->
                <div class="messages-container" id="messagesContainer">
                    <div id="messagesList" class="messages-list"></div>
                </div>

                <!-- Typing Indicator -->
                <div id="typingIndicator" class="typing-indicator" style="display: none;">
                    <span class="typing-dots">
                        <span></span><span></span><span></span>
                    </span>
                    <span id="typingText">–ø–µ—á–∞—Ç–∞–µ—Ç...</span>
                </div>

                <!-- Message Input -->
                <div class="message-input">
                    <input type="file" id="fileInput" style="display: none;" multiple accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.txt,.zip,.rar">
                    
                    <!-- Attach Menu -->
                    <div class="attach-menu" id="attachMenu" style="display: none;">
                        <div class="attach-item" data-type="photo">
                            <div class="attach-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <span class="material-icons">photo</span>
                            </div>
                            <span>–§–æ—Ç–æ/–í–∏–¥–µ–æ</span>
                        </div>
                        <div class="attach-item" data-type="document">
                            <div class="attach-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <span class="material-icons">insert_drive_file</span>
                            </div>
                            <span>–î–æ–∫—É–º–µ–Ω—Ç</span>
                        </div>
                        <div class="attach-item" data-type="audio">
                            <div class="attach-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <span class="material-icons">headphones</span>
                            </div>
                            <span>–ê—É–¥–∏–æ</span>
                        </div>
                    </div>
                    
                    <button class="icon-btn" id="attachBtn">
                        <span class="material-icons">attach_file</span>
                    </button>
                    <div class="input-wrapper">
                        <textarea id="messageTextarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." rows="1"></textarea>
                    </div>
                    <button class="icon-btn" id="emojiBtn">
                        <span class="material-icons">sentiment_satisfied_alt</span>
                    </button>
                    <button class="btn-send" id="sendBtn">
                        <span class="material-icons">send</span>
                    </button>
                </div>
                
                <!-- File Preview -->
                <div class="file-preview" id="filePreview" style="display: none;">
                    <div class="file-preview-header">
                        <span>–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</span>
                        <button class="icon-btn" id="clearFilesBtn">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="file-preview-list" id="filePreviewList"></div>
                </div>
            </div>
        </div>

        <!-- –ù–û–í–û–ï: Chat Info Panel -->
        <div class="chat-info-panel" id="chatInfoPanel">
            <div class="chat-info-header">
                <button class="icon-btn" id="closeChatInfoBtn">
                    <span class="material-icons">arrow_back</span>
                </button>
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            </div>

            <div class="chat-info-content">
                <!-- Chat Avatar Large -->
                <div class="chat-info-avatar-section">
                    <div class="chat-info-avatar" id="chatInfoAvatar">
                        <span class="material-icons">group</span>
                    </div>
                    <h2 id="chatInfoName">–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞</h2>
                    <p id="chatInfoStatus">–°—Ç–∞—Ç—É—Å</p>
                </div>

                <!-- Group Members (for group chats) -->
                <div class="chat-info-section" id="chatMembersSection" style="display: none;">
                    <h4 id="chatMembersTitle">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h4>
                    <div id="chatMembersList"></div>
                </div>

                <!-- Chat Settings -->
                <div class="chat-info-section">
                    <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
                    <div class="info-item" id="muteNotifications">
                        <span class="material-icons">notifications_off</span>
                        <span>–û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                    </div>
                    <div class="info-item" id="searchInChat">
                        <span class="material-icons">search</span>
                        <span>–ü–æ–∏—Å–∫ –≤ —á–∞—Ç–µ</span>
                    </div>
                </div>

                <!-- Actions -->
                <div class="chat-info-section">
                    <h4>–î–µ–π—Å—Ç–≤–∏—è</h4>
                    <div class="info-item danger" id="clearHistory">
                        <span class="material-icons">delete_sweep</span>
                        <span>–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</span>
                    </div>
                    <div class="info-item danger" id="leaveChat">
                        <span class="material-icons">logout</span>
                        <span>–ü–æ–∫–∏–Ω—É—Ç—å —á–∞—Ç</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–û–í–û–ï: Chat Info Backdrop -->
        <div class="chat-info-backdrop" id="chatInfoBackdrop"></div>

        <!-- Tasks Area -->
        <div id="tasksArea" class="tasks-container" style="display: none;">
            <div class="tasks-header">
                <div class="tasks-header-left">
                    <h2>–ó–∞–¥–∞—á–∏</h2>
                </div>
                
                <!-- View Toggle - –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
                <div class="view-toggle">
                    <button class="view-toggle-btn active" data-view="board">
                        <span class="material-icons">view_kanban</span>
                        <span>–î–æ—Å–∫–∞</span>
                    </button>
                    <button class="view-toggle-btn" data-view="list">
                        <span class="material-icons">view_list</span>
                        <span>–°–ø–∏—Å–æ–∫</span>
                    </button>
                </div>
                
                <div class="tasks-header-right">
                    <div class="tasks-filters">
                        <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                        <button class="filter-btn" data-filter="my">–ú–æ–∏ –∑–∞–¥–∞—á–∏</button>
                        <button class="filter-btn" data-filter="created">–°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–Ω–æ–π</button>
                        <button class="filter-btn" data-filter="watching">–ù–∞–±–ª—é–¥–∞—é</button>
                    </div>
                    <button class="create-task-btn" id="createTaskBtn">
                        <span class="material-icons">add</span>
                        <span>–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</span>
                    </button>
                </div>
            </div>
            
            <div id="kanbanBoard" class="kanban-board"></div>
            <div id="tasksList" class="tasks-list" style="display: none;"></div>
        </div>

        <!-- Admin Area -->
        <div id="adminArea" class="admin-container" style="display: none;">
            <aside class="admin-sidebar">
                <div class="admin-sidebar-header">
                    <h2>
                        <span class="material-icons">admin_panel_settings</span>
                        –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
                    </h2>
                </div>
                
                <nav class="admin-nav">
                    <div class="admin-nav-item active" data-view="dashboard">
                        <span class="material-icons">dashboard</span>
                        <span>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    </div>
                    <div class="admin-nav-item" data-view="users">
                        <span class="material-icons">people</span>
                        <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </div>
                    <div class="admin-nav-item" data-view="departments">
                        <span class="material-icons">business</span>
                        <span>–û—Ç–¥–µ–ª—ã</span>
                    </div>
                    <div class="admin-nav-item" data-view="tasks">
                        <span class="material-icons">task_alt</span>
                        <span>–ó–∞–¥–∞—á–∏</span>
                    </div>
                </nav>
            </aside>
            
            <main class="admin-main">
                <div class="admin-content" id="adminContent">
                    <!-- Content will be rendered here -->
                </div>
            </main>
        </div>

        <!-- Admin User Modal -->
        <div id="adminUserModal" class="modal">
            <div class="modal-content admin-modal-content">
                <div class="modal-header">
                    <h2 id="adminUserModalTitle">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                    <button class="icon-btn" id="closeAdminUserModalBtn">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                
                <div class="modal-body">
                    <form id="adminUserForm">
                        <input type="hidden" id="adminUserId">
                        
                        <div class="admin-form-group">
                            <label for="adminUserName">–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                            <input type="text" id="adminUserName" required>
                        </div>
                        
                        <div class="admin-form-group">
                            <label for="adminUserEmail">Email *</label>
                            <input type="email" id="adminUserEmail" required>
                        </div>
                        
                        <div class="admin-form-group">
                            <label for="adminUserUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                            <input type="text" id="adminUserUsername" required>
                        </div>
                        
                        <div class="admin-form-group">
                            <label for="adminUserPassword">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="adminUserPassword">
                            <small style="color: var(--text-secondary); font-size: 12px;">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å</small>
                        </div>
                        
                        <div class="admin-form-group">
                            <label for="adminUserRole">–†–æ–ª—å</label>
                            <select id="adminUserRole">
                                <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                                <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                            </select>
                        </div>
                    </form>
                </div>
                
                <div class="modal-footer">
                    <button class="btn-secondary" id="cancelAdminUserBtn">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary" id="saveAdminUserBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- Admin Department Modal -->
        <div id="adminDepartmentModal" class="modal">
            <div class="modal-content admin-modal-content">
                <div class="modal-header">
                    <h2 id="adminDepartmentModalTitle">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª</h2>
                    <button class="icon-btn" id="closeAdminDepartmentModalBtn">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                
                <div class="modal-body">
                    <form id="adminDepartmentForm">
                        <input type="hidden" id="adminDepartmentId">
                        
                        <div class="admin-form-group">
                            <label for="adminDepartmentName">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ *</label>
                            <input type="text" id="adminDepartmentName" required>
                        </div>
                        
                        <div class="admin-form-group">
                            <label for="adminDepartmentDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea id="adminDepartmentDescription"></textarea>
                        </div>
                    </form>
                </div>
                
                <div class="modal-footer">
                    <button class="btn-secondary" id="cancelAdminDepartmentBtn">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary" id="saveAdminDepartmentBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- Video Conference Panel (Fullscreen) -->
        <div id="conferencePanel" class="conference-panel" style="display: none;">
            <!-- Top Bar -->
            <div class="conference-header" id="conferenceHeader">
                <div class="conference-info">
                    <div>
                        <h3 id="conferenceName">–í–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è</h3>
                        <p id="conferenceParticipants">0 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
                    </div>
                </div>
            </div>

            <!-- Video Grid -->
            <div class="conference-grid" id="conferenceGrid" data-participants="0">
                <!-- Video tiles will be added dynamically -->
            </div>

            <!-- Bottom Controls -->
            <div class="conference-controls" id="conferenceControls">
                <button class="control-btn" id="toggleMicBtn" title="–í—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω">
                    <span class="material-icons">mic</span>
                </button>
                <button class="control-btn" id="toggleCameraBtn" title="–í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É">
                    <span class="material-icons">videocam</span>
                </button>
                <button class="control-btn" id="shareScreenBtn" title="–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞">
                    <span class="material-icons">screen_share</span>
                </button>
                <button class="control-btn" id="backgroundBtn" title="–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ñ–æ–Ω">
                    <span class="material-icons">wallpaper</span>
                </button>
                <button class="control-btn" id="fullscreenBtn" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º">
                    <span class="material-icons">fullscreen</span>
                </button>
                <button class="control-btn settings-btn" id="settingsBtn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                    <span class="material-icons">settings</span>
                </button>
                <button class="control-btn end-call-btn" id="endCallBtn" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫">
                    <span class="material-icons">call_end</span>
                </button>
            </div>

            <!-- Toggle Sidebar Button -->
            <button class="toggle-sidebar-btn" id="toggleSidebarBtn" title="–ß–∞—Ç –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∏">
                <span class="material-icons">chat</span>
            </button>

            <!-- Sidebar (Chat/Participants) -->
            <div class="conference-sidebar" id="conferenceSidebar">
                <div class="sidebar-header">
                    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <button class="sidebar-close-btn" id="closeSidebarBtn">
                        <span class="material-icons">close</span>
                    </button>
                </div>

                <div class="sidebar-tabs">
                    <button class="tab-btn active" data-tab="participants">
                        <span class="material-icons">people</span>
                        –£—á–∞—Å—Ç–Ω–∏–∫–∏
                    </button>
                    <button class="tab-btn" data-tab="chat">
                        <span class="material-icons">chat</span>
                        –ß–∞—Ç
                    </button>
                </div>

                <div class="sidebar-content">
                    <div id="participantsPanel" class="tab-content active">
                        <div id="participantsList"></div>
                    </div>
                    <div id="chatPanel" class="tab-content">
                        <div id="conferenceChat">
                            <p style="color: rgba(255,255,255,0.5); text-align: center; padding: 40px 20px;">
                                –ß–∞—Ç –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Chat Modal -->
    <div id="newChatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ù–æ–≤—ã–π —á–∞—Ç</h2>
                <button class="icon-btn" id="closeModalBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="chat-type-selector">
                    <button class="type-btn active" data-type="private">
                        <span class="material-icons">person</span>
                        –õ–∏—á–Ω—ã–π —á–∞—Ç
                    </button>
                    <button class="type-btn" data-type="group">
                        <span class="material-icons">group</span>
                        –ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç
                    </button>
                </div>

                <div id="privateChat" class="chat-type-content">
                    <div class="search-users">
                        <input type="text" id="userSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...">
                    </div>
                    <div id="usersList" class="users-list"></div>
                </div>

                <div id="groupChat" class="chat-type-content" style="display: none;">
                    <div class="input-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</label>
                        <input type="text" id="groupNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã">
                    </div>
                    <div class="search-users">
                        <input type="text" id="groupUserSearchInput" placeholder="–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...">
                    </div>
                    <div id="selectedUsers" class="selected-users"></div>
                    <div id="groupUsersList" class="users-list"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelChatBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-primary" id="createChatBtn">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Notification Permission -->
    <div id="notificationBanner" class="notification-banner" style="display: none;">
        <span class="material-icons">notifications</span>
        <span>–†–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–≤–æ–Ω–∫–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π</span>
        <button id="enableNotifications">–†–∞–∑—Ä–µ—à–∏—Ç—å</button>
        <button id="dismissNotifications" class="icon-btn">
            <span class="material-icons">close</span>
        </button>
    </div>

    <!-- Incoming Call Modal -->
    <div id="incomingCallModal" class="modal" style="display: none;">
        <div id="incomingCallContent" class="modal-content"></div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Emoji Picker -->
    <div class="emoji-picker" id="emojiPicker" style="display: none;">
        <div class="emoji-picker-header">
            <input type="text" id="emojiSearch" placeholder="–ü–æ–∏—Å–∫ —ç–º–æ–¥–∑–∏...">
        </div>
        <div class="emoji-categories">
            <button class="emoji-category active" data-category="smileys">üòä</button>
            <button class="emoji-category" data-category="people">üëã</button>
            <button class="emoji-category" data-category="animals">üê∂</button>
            <button class="emoji-category" data-category="food">üçï</button>
            <button class="emoji-category" data-category="travel">‚úàÔ∏è</button>
            <button class="emoji-category" data-category="objects">üí°</button>
            <button class="emoji-category" data-category="symbols">‚ù§Ô∏è</button>
            <button class="emoji-category" data-category="flags">üèÅ</button>
        </div>
        <div class="emoji-list" id="emojiList"></div>
    </div>

    <!-- User Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content profile-modal-content">
            <div class="modal-header">
                <h2>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
                <button class="icon-btn" id="closeProfileBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            
            <div class="profile-modal-body">
                <!-- Avatar Section -->
                <div class="profile-avatar-section">
                    <div class="profile-avatar-wrapper">
                        <div class="profile-avatar-large" id="profileAvatarDisplay">
                            <span class="material-icons">person</span>
                        </div>
                        <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                        <button class="change-avatar-btn" id="changeAvatarBtn">
                            <span class="material-icons">photo_camera</span>
                        </button>
                    </div>
                </div>

                <!-- Profile Info -->
                <div class="profile-info-section">
                    <div class="profile-field">
                        <label>–ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                        <div class="profile-field-content">
                            <input type="text" id="profileNameInput" class="profile-input" readonly>
                            <button class="icon-btn" id="editNameBtn">
                                <span class="material-icons">edit</span>
                            </button>
                        </div>
                    </div>

                    <div class="profile-field">
                        <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <div class="profile-field-content">
                            <input type="text" id="profileUsernameDisplay" class="profile-input" readonly disabled>
                        </div>
                        <p class="field-hint">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å</p>
                    </div>

                    <div class="profile-field">
                        <label>Email</label>
                        <div class="profile-field-content">
                            <input type="email" id="profileEmailInput" class="profile-input" readonly>
                            <button class="icon-btn" id="editEmailBtn">
                                <span class="material-icons">edit</span>
                            </button>
                        </div>
                    </div>

                    <div class="profile-field">
                        <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <div class="profile-field-content">
                            <input type="text" id="profileUserIdDisplay" class="profile-input" readonly disabled>
                        </div>
                    </div>
                </div>

                <!-- Save Button (hidden by default) -->
                <div class="profile-actions" id="profileActions" style="display: none;">
                    <button class="btn-secondary" id="cancelProfileChanges">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary" id="saveProfileChanges">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>

                <!-- Logout Button -->
                <div class="profile-danger-zone">
                    <button class="btn-danger" id="logoutBtn">
                        <span class="material-icons">logout</span>
                        –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                    </button>
                </div>

                <!-- Theme Settings -->
                <div class="profile-info-section">
                    <div class="profile-field">
                        <label>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                    </div>
                    
                    <div class="profile-settings-item" id="openThemeSettings">
                        <span class="material-icons">palette</span>
                        <span id="currentThemeLabel">–°–∏—Å—Ç–µ–º–Ω–∞—è</span>
                        <span class="material-icons">chevron_right</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Settings Modal -->
    <div id="themeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–í—ã–±–æ—Ä —Ç–µ–º—ã</h2>
                <button class="icon-btn" id="closeThemeModal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            
            <div class="theme-settings">
                <div class="theme-option" data-theme="light">
                    <div class="theme-option-icon">
                        <span class="material-icons">wb_sunny</span>
                    </div>
                    <div class="theme-option-info">
                        <h4>–°–≤–µ—Ç–ª–∞—è</h4>
                        <p>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</p>
                    </div>
                    <div class="theme-option-check">
                        <span class="material-icons">check</span>
                    </div>
                </div>
                
                <div class="theme-option" data-theme="dark">
                    <div class="theme-option-icon">
                        <span class="material-icons">nights_stay</span>
                    </div>
                    <div class="theme-option-info">
                        <h4>–¢–µ–º–Ω–∞—è</h4>
                        <p>–ü—Ä–∏—è—Ç–Ω–∞—è –¥–ª—è –≥–ª–∞–∑ —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞</p>
                    </div>
                    <div class="theme-option-check">
                        <span class="material-icons">check</span>
                    </div>
                </div>
                
                <div class="theme-option active" data-theme="auto">
                    <div class="theme-option-icon">
                        <span class="material-icons">brightness_auto</span>
                    </div>
                    <div class="theme-option-info">
                        <h4>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</h4>
                        <p>–°–ª–µ–¥—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º</p>
                    </div>
                    <div class="theme-option-check">
                        <span class="material-icons">check</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Create/Edit Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="taskModalTitle">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h2>
                <button class="icon-btn" id="closeTaskModalBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="taskForm">
                    <input type="hidden" id="taskId">
                    
                    <div class="task-form-group">
                        <label for="taskTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                        <input type="text" id="taskTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" required>
                    </div>
                    
                    <div class="task-form-group">
                        <label for="taskDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="taskDescription" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –ø–æ–¥—Ä–æ–±–Ω–µ–µ"></textarea>
                    </div>
                    
                    <div class="task-form-group">
                        <label for="taskDepartment">–û—Ç–¥–µ–ª *</label>
                        <select id="taskDepartment" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª</option>
                        </select>
                    </div>
                    
                    <div class="task-form-group">
                        <label for="taskAssignee">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</label>
                        <select id="taskAssignee">
                            <option value="">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ</option>
                        </select>
                    </div>
                    
                    <div class="task-form-group">
                        <label for="taskPriority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                        <select id="taskPriority">
                            <option value="low">–ù–∏–∑–∫–∏–π</option>
                            <option value="normal" selected>–û–±—ã—á–Ω—ã–π</option>
                            <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                            <option value="urgent">–°—Ä–æ—á–Ω—ã–π</option>
                        </select>
                    </div>
                    
                    <div class="task-form-group">
                        <label for="taskDueDate">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
                        <input type="date" id="taskDueDate">
                    </div>
                    
                    <div class="task-form-group">
                        <label>–ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏</label>
                        <div id="taskWatchersContainer"></div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelTaskBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-primary" id="saveTaskBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Task Details Modal -->
    <div id="taskDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-body">
                <div id="taskDetailsContent"></div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
   <!-- 1. SOCKET.IO - –ü–ï–†–í–´–ú (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞) -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    
    <!-- 2. THEME - –í–¢–û–†–´–ú (–±–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è) -->
    <script src="/js/theme.js"></script>
    
    <!-- 3. APP.JS - –¢–†–ï–¢–¨–ò–ú (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É, –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•) -->
    <!-- –ö–†–ò–¢–ò–ß–ù–û: app.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ë–ï–ó defer, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–µ—Ä–≤—ã–º -->
    <script src="/js/app.js"></script>
    
    <!-- 4. –í–°–ï –û–°–¢–ê–õ–¨–ù–´–ï - –° DEFER (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö) -->
    <!-- defer –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –æ–Ω–∏ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –ü–û–°–õ–ï —Ç–æ–≥–æ –∫–∞–∫ app.js –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É -->
    <script src="/js/attachments-emoji.js" defer></script>
    <script src="/js/webrtc-simple.js" defer></script>
    <script src="/js/virtual-background-simple.js" defer></script>
    <script src="/js/profile.js" defer></script>
    <script src="/js/ui-components.js" defer></script>
    <script src="/js/admin.js" defer></script>
    <script src="/js/mobile-navigation.js" defer></script>
    <script src="/js/chat-info.js" defer></script>
    <script src="/js/tasks.js"></script>
    <script src="/js/tasks-gamified.js" defer></script>
</body>
</html>